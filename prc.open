:'##############################################################:'# 2013-09-18 ejl build schedule's Open list page:
:'#                 runs via cgi-bin/sched_complete:'# 2013-12-03 ejl  add jquery for couple little effects:
:'# 2014-03-04 ejl  ISR 26031 add table sorting:'# 2014-03-04 ejl ISR 26031 add export button:
:'# 2014-03-06 EJL removed crap tablesorter code in favor of jquery.dataTables::
:@rn ne "1":exit:
::declare process_id(8,.0); process_id=@pm:
::declare global type, desc; type=@pw; desc=@px:
::declare global includeFile:
::declare lang; lang=getenv("LANG"):
::'system "echo"<lang<"| mutt -s prc.open ericl@borisch.com":
::gosub pagehdr:
::gosub filldat:
::gosub pageftr:
::end:
pagehdr:'build page header::
::declare pageTitle; pageTitle="Open ("{desc{")":
:lang eq "SP":pageTitle="Abierto ("{desc{")":
::declare outfile:
::outfile=getenv("HTML_RESP_FILE"):
::pg(1,.0,g) = "1":
::html pg cr outfile ti pageTitle:
:not html        'cant create file:exit:
::html pg tx "<script type='text/javascript'>":
:        'auto refresh every minute:html pg tx "var timer = setInterval('autoRefresh()', 1000*60);":
::html pg tx "function autoRefresh(){self.location.reload(true);}":
::html pg tx "</script>":
::html pg tx "<script src=\"/scheduling/javascript/jquery-1.10.2.min.js\"></script>":
::html pg tx "<script src=\"/scheduling/javascript/jquery.dataTables.min.js\"></script>":
::html pg tx "<script src=\"/scheduling/javascript/jquery.cookie.js\"></script>":
:                        'body:html pg bo:
:'include menu "header"::
::includefile="/appl/www/html/scheduling/include/headermenustyle.css"; call "c_incfile":
:'!!! USES DIFFERENT INCLUDE LOGIC FILE:includefile="/appl/www/html/scheduling/include/menu.html"; call "c_incfilePHP":
::'include javascript needed:
::declare scrtext;scrtext="<script language=\"JavaScript\" type=\"text/javascript\"":
::html pg tx scrtext<"src=\"/scheduling/javascript/sched_complete.js\"></script>":
::html pg tx scrtext<"src=\"/scheduling/javascript/sched_reprioritize.js\"></script>":
::declare jqtext:
::jqtext="<script>":
::jqtext=jqtext{"$(document).ready(function(){":
::jqtext=jqtext{"$(\"a\").hover(function(){":
:'first hover arg:jqtext=jqtext&"$(this).parents(\"#line\").css(\"background-color\",\"aquamarine\");},":
:'2nd hover arg:jqtext=jqtext{"function(){$(this).parents(\"#line\").css(\"background-color\",\"white\");});});":
::jqtext=jqtext{"</script>":
::html pg tx jqtext:
::html pg tx "<script>$(document).ready(function(){$('#table').dataTable({\"bPaginate\"false});});</script>":
::return:
filldat:' fill data onto page:' only for non-Completed travs (i.e. no Date Out filled in):
::'first create table:
:'and first load new style for table (menu header had different style):includefile="/appl/www/html/scheduling/include/datatablestyle.html"; call "c_incfile":
::includefile="/appl/www/html/scheduling/include/generalstyle.css"; call "c_incfile":
::includefile="/appl/www/html/scheduling/include/login.html"; call "c_incfile":
::declare text;text="Open"; text2="Export":
:lang eq "SP":text="Abierto"; text2="Exportar":
::line="<input type='button' value='"{text2{"' onclick='clkLoginExp(\"show\",\""{type{"\",\"open\")' style='floatright'>":
::html pg tx "<center><h1 style='font-size33px'>"{text<"("{desc{")"{line{"</h1></center>":
::html pg tx "<br><center><table class=\"datatable\" id='table'>":
::text="Priority":
:lang eq "SP":text="Prioridad":
::declare line;:
::line="<thead><tr><th>"{text{"</th>":
::declare text2, text3:
::text="Assembly"; text2="Traveler/RPN"; text3="Qty":
:lang eq "SP":text="Ensamble"; text3="Cantidad":
::line=line{"<th>"{text{"</th>":
::line=line{"<th>"{text2{"</th><th>"{text3{"</th>":
::text="Time In":
:lang eq "SP":text="Tiempo de entrada":
::line=line{"<th>"{text{"</th><th></th></tr></thead>":
::html pg tx line:
::html pg tx "<tbody>":
::'now look up open travs:
:        'type, priority (assumes closed items have priority wiped):lookup schd = scheduling  k=(type&"1")   i=E -ng:
schdlp:not schd:goto endschd:
:schd(10) ne type:goto endschd:
:schd(5) eq ""           'no priority (ie closed):goto endschd:
:schd(21) ne ""          'has date out, closed:goto endschd:
:'now we have open items, sorted by hot then date in (earliest first):declare prtline(3000,*):
::declare timein:
::timein=mid(schd(12),"1","5"):
::declare loglink:
::declare thispage;:
::thispage="/scheduling/open.php?sched="{type{"&desc="{desc{"&lang="{lang:
::hf(1,*)=schd(4):
:hf ne "Y":hf="N":
:        'field is actually 4,.0 but size is overkill. need padding for tablesort, being treated as a string..:declare pri(3,rjfill0);:
::pri=schd(5):
:        'clkLogin('show',recnum,type,desc):loglink="<a class='loginLink' href='javascriptclkLogin(\"show\","{schd(@rn){",\""{type{"\",\""{desc{"\",\""{hf{"\");'":
::loglink=loglink{"style='background-colortransparent;'><b>"{pri{"</b></a>":
:schd(4) eq "Y":prtline="<tr id=\"line\"><td style='background-color#FF0000'>"{loglink{"</td>":
:schd(4) ne "Y":prtline="<tr id=\"line\"><td>"{loglink{"</td>":
::prtline=prtline{"<td>"{schd(2){"</td><td>"{schd(1){"</td><td>"{schd(13){"</td><td>"{schd(11)<"@"<timein:
::declare signofflink;:
:         'complete(recnum,travnum,type):signofflink="complete("{schd(@rn){",'"{schd(1){"','"{schd(10){"')":
::prtline=prtline{"</td><td><b><a href="{thispage<" onclick=\""{signofflink{";\" style='background-colortransparent';":
::text="Complete":
:lang eq "SP":text="Completar":
::prtline=prtline{">"{text{"</a></b></td></tr>":
::html pg tx prtline:
nxtschd::getnext schd; goto schdlp:
endschd:::
:'close table:html pg tx "</tbody></table>":
::return:
pageftr:'footer::
::html pg br:
::text="Page generated":
:lang eq "SP":text="Pagina generada":
::html pg tx "<hr><div align=\"center\" style='font-size15px'>"{text{" " < @td < @tm <"</div>":
::html pg bo-:
::html pg cl:
::return:
